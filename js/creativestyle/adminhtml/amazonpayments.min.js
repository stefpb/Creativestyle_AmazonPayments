var AmazonPaymentsAdmin=Class.create();AmazonPaymentsAdmin.prototype={setupConfig:function(i){i&&(this.unique_id=i.unique_id||null,this.fields=i.fields||{},this.merchant_id=$F(this.fields.merchant_id)||null,this.client_id=$F(this.fields.client_id)||null,this.layers=i.layers||{},this.messages=i.messages||{},this.urls=i.urls||{})},setupRegistration:function(i){i&&($(i.submit)&&Event.observe($(i.submit),"click",this.startSimplePathRegistration.bindAsEventListener(this,$(i.region),$(i.language))),this.registration=i)},setupValidation:function(i,t){i&&($(i.submit)&&Event.observe($(i.submit),"click",this.startSimplePathValidation.bindAsEventListener(this,$(i.json_field),$(t.region))),$(i.use_button)&&Event.observe($(i.use_button),"click",this.useNewOptions.bindAsEventListener(this)),$(i.save_button)&&Event.observe($(i.save_button),"click",this.useNewOptionsAndSave.bindAsEventListener(this)),$(i.cancel_button)&&Event.observe($(i.cancel_button),"click",this.cancelValidation.bindAsEventListener(this)),$(i.json_field)&&i.placeholder&&$(i.json_field).setAttribute("placeholder",i.placeholder),this.validation=i)},cancelValidation:function(i){this.showSimplePathValidationJson(!0),this.showSimplePathValidationSubmit(!0),this.enableSimplePathRegistrationRegion(!0)},useNewOptions:function(i){this.populateNewOptions()},useNewOptionsAndSave:function(i){this.populateNewOptions(),configForm.submit()},populateNewOptions:function(){if(region=$F(this.registration.region),options=$F(this.validation.json_field),options)try{options=options.evalJSON(!0),$F(this.fields.merchant_id)!=options.merchant_id&&($(this.fields.merchant_id).disabled&&$(this.fields.merchant_id.identify()+"_inherit").click(),this.fields.merchant_id.setValue(options.merchant_id)),$F(this.fields.client_id)!=options.client_id&&($(this.fields.client_id).disabled&&$(this.fields.client_id.identify()+"_inherit").click(),this.fields.client_id.setValue(options.client_id)),$F(this.fields.access_key)!=options.access_key&&($(this.fields.access_key).disabled&&$(this.fields.access_key.identify()+"_inherit").click(),this.fields.access_key.setValue(options.access_key)),$F(this.fields.secret_key)!=options.secret_key&&($(this.fields.secret_key).disabled&&$(this.fields.secret_key.identify()+"_inherit").click(),this.fields.secret_key.setValue(options.secret_key)),region&&$F(this.fields.region)!=region&&($(this.fields.region).disabled&&$(this.fields.region.identify()+"_inherit").click(),this.fields.region.setValue(region))}catch(i){console.error(i)}},setupView:function(){this.isConfigured()?(this.disableRegionSynchronization(),this.showSellerCentralConfiguration(!0),this.showSimplePathRegistration(!1)):(this.enableRegionSynchronization(),this.showSellerCentralConfiguration(!1),this.showSimplePathRegistration(!0))},showSellerCentralConfiguration:function(i){i?($(this.layers.seller_central+"-state").setValue(1),Fieldset.applyCollapse(this.layers.seller_central)):($(this.layers.seller_central+"-state").setValue(0),Fieldset.applyCollapse(this.layers.seller_central))},showSimplePathRegistration:function(i){i?($(this.registration.id+"-state").setValue(1),Fieldset.applyCollapse(this.registration.id)):($(this.registration.id+"-state").setValue(0),Fieldset.applyCollapse(this.registration.id))},showSimplePathValidationSubmit:function(i){i?$(this.validation.submit).show():$(this.validation.submit).hide()},showSimplePathValidationJson:function(i){i?($(this.validation.result).hide(),$(this.validation.result_buttons).hide(),$(this.validation.json_field.up("tr").show())):($(this.validation.result).show(),$(this.validation.result_buttons).show(),$(this.validation.json_field.up("tr").hide()))},enableSimplePathRegistrationRegion:function(i){i?($(this.registration.region).enable(),$(this.registration.region).removeClassName("disabled"),$(this.registration.submit).enable(),$(this.registration.submit).removeClassName("disabled")):($(this.registration.region).disable(),$(this.registration.region).addClassName("disabled"),$(this.registration.submit).disable(),$(this.registration.submit).addClassName("disabled"))},enableRegionSynchronization:function(){this.fields.region.setValue($F(this.registration.region)),Event.observe($(this.registration.region),"change",this.synchronizeRegions.bindAsEventListener(this))},disableRegionSynchronization:function(){Event.stopObserving($(this.registration.region),"change")},synchronizeRegions:function(i){this.fields.region.setValue($F(Event.findElement(i)))},startSimplePathRegistration:function(i,t,e){form=new Element("form",{method:"post",action:this.simplePathRegistrationUrl[$F(t)],target:"_blank"}),form.insert(new Element("input",{name:"spId",value:this.spIds[$F(t)],type:"hidden"})),form.insert(new Element("input",{name:"locale",value:$F(t),type:"hidden"})),form.insert(new Element("input",{name:"language",value:$F(e),type:"hidden"})),this.unique_id&&form.insert(new Element("input",{name:"uniqueId",value:this.unique_id,type:"hidden"})),this.urls.sandbox_ipn&&form.insert(new Element("input",{name:"sandboxMerchantIPNURL",value:this.urls.sandbox_ipn,type:"hidden"})),this.urls.production_ipn&&form.insert(new Element("input",{name:"productionMerchantIPNURL",value:this.urls.production_ipn,type:"hidden"})),this.urls.js_origins&&this.urls.js_origins.each(function(i){form.insert(new Element("input",{name:"allowedLoginDomains[]",value:i,type:"hidden"}))}),this.urls.return_urls&&this.urls.return_urls.each(function(i){form.insert(new Element("input",{name:"loginRedirectURLs[]",value:i,type:"hidden"}))}),$(document.body).insert(form),form.submit()},startSimplePathValidation:function(i,t,e){if(options=$F(t),options)try{options=options.evalJSON(!0),options.region=$F(e),options&&new Ajax.Request(this.validation.url,{method:"post",parameters:options,onSuccess:this.validationCallback.bind(this,options)})}catch(s){this.displayValidationFailureMsg([this.messages.invalid_json])}},validationCallback:function(i,t){if(t.responseText)try{result=t.responseText.evalJSON(!0),result.valid?this.displayValidationSuccessMsg(result.messages,result.data):this.displayValidationFailureMsg(result.messages)}catch(e){this.displayValidationFailureMsg([this.messages.invalid_json])}},displayValidationSuccessMsg:function(i,t){msg='<ul class="messages"><li class="success-msg"><ul>',i.each(function(i){msg=msg+"<li>"+i+"</li>"}),t&&(msg+='<li><table style="width:100%;"><tbody>',$H(t).each(function(i){msg=msg+'<tr><th style="text-align:right;">'+i.key+':</th><td style="font-weight:normal;">'+i.value+"</td></tr>"}),msg+="</tbody></table></li>"),msg+="</ul></li></ul>",$(this.validation.result).update(msg),this.showSimplePathValidationJson(!1),this.showSimplePathValidationSubmit(!1),this.enableSimplePathRegistrationRegion(!1)},displayValidationFailureMsg:function(i){msg='<ul class="messages"><li class="error-msg"><ul>',i.each(function(i){msg=msg+"<li>"+i+"</li>"}),msg+="</ul></li></ul>",$(this.validation.result).update(msg).show()},isConfigured:function(){return this.merchant_id},spIds:{EUR:"AIOVPYYF70KB5",GBP:"ASGN9CNMS5AA3"},simplePathRegistrationUrl:{EUR:"https://sellercentral-europe.amazon.com/hz/me/sp/redirect?ld=SPEXDEAPA-MagentoPL",GBP:"https://sellercentral-europe.amazon.com/hz/me/sp/redirect?ld=SPEXUKAPA-MagentoPL"},initialize:function(i){this.setupConfig(i.config),this.setupRegistration(i.registration),this.setupValidation(i.validation,i.registration),this.setupView()}};